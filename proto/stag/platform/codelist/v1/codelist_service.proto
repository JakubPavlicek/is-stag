syntax = "proto3";

package stag.platform.codelist.v1;

import "buf/validate/validate.proto";

option java_package = "com.stag.platform.codelist.v1";
option java_outer_classname = "CodelistServiceProto";
option java_multiple_files = true;

service CodelistService {
  // Generic codelist lookup
  rpc GetCodelistValues(GetCodelistValuesRequest)
      returns (GetCodelistValuesResponse);

  // Use-case specific methods
  rpc GetPersonProfileData(GetPersonProfileDataRequest)
      returns (GetPersonProfileDataResponse);
  rpc GetPersonAddressData(GetPersonAddressDataRequest)
      returns (GetPersonAddressDataResponse);
  rpc GetPersonBankingData(GetPersonBankingDataRequest)
      returns (GetPersonBankingDataResponse);
  rpc GetPersonEducationData(GetPersonEducationDataRequest)
      returns (GetPersonEducationDataResponse);
}

message GetCodelistValuesRequest {

  repeated CodelistKey codelist_keys = 1 [
    (buf.validate.field).repeated.min_items = 1,
    (buf.validate.field).repeated.max_items = 10
  ];

  string language = 2 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];

}

message GetCodelistValuesResponse {
  repeated CodelistValue codelist_values = 1;
}

// Person Profile specific (only what's needed for GET /persons/{id})
message GetPersonProfileDataRequest {

  repeated CodelistKey codelist_keys = 1 [
    (buf.validate.field).repeated.min_items = 1,
    (buf.validate.field).repeated.max_items = 10
  ];

  optional int32 birth_country_id = 2 [
    (buf.validate.field).int32.gte = 0
  ];

  optional int32 citizenship_country_id = 3 [
    (buf.validate.field).int32.gte = 0
  ];

  string language = 4 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];

}

message GetPersonProfileDataResponse {
  repeated CodelistValue codelist_values = 1;
  optional string birth_country_name = 2;
  optional string citizenship_country_name = 3;
}

// Person Address specific (only what's needed for GET /persons/{id}/addresses)
message GetPersonAddressDataRequest {

  // Permanent address
  optional int64 permanent_municipality_part_id = 1 [
    (buf.validate.field).int64.gte = 0
  ];

  optional int32 permanent_country_id = 2 [
    (buf.validate.field).int32.gte = 0
  ];

  // Temporary address
  optional int64 temporary_municipality_part_id = 3 [
    (buf.validate.field).int64.gte = 0
  ];

  optional int32 temporary_country_id = 4 [
    (buf.validate.field).int32.gte = 0
  ];

  string language = 5 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];

}

message GetPersonAddressDataResponse {
  // Permanent residence
  optional string permanent_municipality_name = 1;
  optional string permanent_municipality_part_name = 2;
  optional string permanent_district_name = 3;
  optional string permanent_country_name = 4;

  // Temporary residence
  optional string temporary_municipality_name = 5;
  optional string temporary_municipality_part_name = 6;
  optional string temporary_district_name = 7;
  optional string temporary_country_name = 8;
}

// Banking specific request (for GET /persons/{id}/banking)
message GetPersonBankingDataRequest {

  repeated CodelistKey codelist_keys = 1 [
    (buf.validate.field).repeated.min_items = 1,
    (buf.validate.field).repeated.max_items = 10
  ];

  optional int32 euro_account_country_id = 2 [
    (buf.validate.field).int32.gte = 0
  ];

  string language = 3 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];

}

message GetPersonBankingDataResponse {
  repeated CodelistValue codelist_values = 1;
  optional string euro_account_country_name = 2;
}

// Education specific request (for GET /persons/{id}/education)
message GetPersonEducationDataRequest {

  optional string high_school_id = 1 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 10
  ];

  optional string high_school_field_of_study_number = 2 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 10
  ];

  optional int32 high_school_country_id = 3 [
    (buf.validate.field).int32.gte = 0
  ];

  string language = 4 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];

}

message GetPersonEducationDataResponse {
  optional string high_school_name = 1;
  optional string high_school_street = 2;
  optional string high_school_zip_code = 3;
  optional string high_school_municipality_name = 4;
  optional string high_school_district_name = 5;
  optional string high_school_field_of_study = 6;
  optional string high_school_country_name = 7;
}

// Generic messages
message CodelistKey {

  string domain = 1 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 100
  ];

  string low_value = 2 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 240
  ];

}

message CodelistValue {
  string domain = 1;
  string low_value = 2;
  string meaning = 3;
}
