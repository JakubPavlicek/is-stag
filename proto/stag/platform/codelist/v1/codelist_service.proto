syntax = "proto3";

package stag.platform.codelist.v1;

import "buf/validate/validate.proto";

option java_package = "com.stag.platform.codelist.v1";
option java_outer_classname = "CodelistServiceProto";
option java_multiple_files = true;

service CodelistService {
  // Generic codelist lookup
  rpc GetCodelistValues(GetCodelistValuesRequest)
      returns (GetCodelistValuesResponse);

  // Use-case specific methods
  rpc GetPersonProfileData(GetPersonProfileDataRequest)
      returns (GetPersonProfileDataResponse);
  rpc GetPersonProfileUpdateData(GetPersonProfileUpdateDataRequest)
      returns (GetPersonProfileUpdateDataResponse);
  rpc GetPersonAddressData(GetPersonAddressDataRequest)
      returns (GetPersonAddressDataResponse);
  rpc GetPersonBankingData(GetPersonBankingDataRequest)
      returns (GetPersonBankingDataResponse);
  rpc GetPersonEducationData(GetPersonEducationDataRequest)
      returns (GetPersonEducationDataResponse);
}

message GetCodelistValuesRequest {
  repeated CodelistKey codelist_keys = 1 [
    (buf.validate.field).repeated.max_items = 10
  ];

  string language = 2 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];
}

message GetCodelistValuesResponse {
  repeated CodelistMeaning codelist_meanings = 1;
}

// Person Profile specific (GET /persons/{personId})
message GetPersonProfileDataRequest {
  repeated CodelistKey codelist_keys = 1 [
    (buf.validate.field).repeated.max_items = 10
  ];

  optional int32 birth_country_id = 2 [
    (buf.validate.field).int32.gte = 1
  ];

  optional int32 citizenship_country_id = 3 [
    (buf.validate.field).int32.gte = 1
  ];

  string language = 4 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];
}

message GetPersonProfileDataResponse {
  repeated CodelistMeaning codelist_meanings = 1;
  optional string birth_country_name = 2;
  optional string citizenship_country_name = 3;
}

// Person Profile Update specific (PATCH /persons/{personId})
message GetPersonProfileUpdateDataRequest {
  optional string marital_status = 1 [
    (buf.validate.field).string.max_len = 240
  ];

  optional string title_prefix = 2 [
    (buf.validate.field).string.max_len = 240
  ];

  optional string title_suffix = 3 [
    (buf.validate.field).string.max_len = 240
  ];

  optional string birth_country_name = 4 [
    (buf.validate.field).string.max_len = 70
  ];
}

message GetPersonProfileUpdateDataResponse {
  optional string marital_status_low_value = 1;
  optional string title_prefix_low_value = 2;
  optional string title_suffix_low_value = 3;
  optional int32 birth_country_id = 4;
}

// Person Address specific (GET /persons/{personId}/addresses)
message GetPersonAddressDataRequest {
  // Permanent address
  optional int64 permanent_municipality_part_id = 1 [
    (buf.validate.field).int64.gte = 1
  ];

  optional int32 permanent_country_id = 2 [
    (buf.validate.field).int32.gte = 1
  ];

  // Temporary address
  optional int64 temporary_municipality_part_id = 3 [
    (buf.validate.field).int64.gte = 1
  ];

  optional int32 temporary_country_id = 4 [
    (buf.validate.field).int32.gte = 1
  ];

  string language = 5 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];
}

message GetPersonAddressDataResponse {
  // Permanent residence
  optional string permanent_municipality_name = 1;
  optional string permanent_municipality_part_name = 2;
  optional string permanent_district_name = 3;
  optional string permanent_country_name = 4;

  // Temporary residence
  optional string temporary_municipality_name = 5;
  optional string temporary_municipality_part_name = 6;
  optional string temporary_district_name = 7;
  optional string temporary_country_name = 8;
}

// Banking specific request (GET /persons/{personId}/banking)
message GetPersonBankingDataRequest {
  repeated CodelistKey codelist_keys = 1 [
    (buf.validate.field).repeated.max_items = 10
  ];

  optional int32 euro_account_country_id = 2 [
    (buf.validate.field).int32.gte = 1
  ];

  string language = 3 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];
}

message GetPersonBankingDataResponse {
  repeated CodelistMeaning codelist_meanings = 1;
  optional string euro_account_country_name = 2;
}

// Education specific request (GET /persons/{personId}/education)
message GetPersonEducationDataRequest {
  optional string high_school_id = 1 [
    (buf.validate.field).string.max_len = 10
  ];

  optional string high_school_field_of_study_number = 2 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 10
  ];

  optional int32 high_school_country_id = 3 [
    (buf.validate.field).int32.gte = 1
  ];

  string language = 4 [
    (buf.validate.field).string.in = "cs",
    (buf.validate.field).string.in = "en"
  ];
}

message GetPersonEducationDataResponse {
  optional string high_school_name = 1;
  optional string high_school_street = 2;
  optional string high_school_zip_code = 3;
  optional string high_school_municipality_name = 4;
  optional string high_school_district_name = 5;
  optional string high_school_field_of_study = 6;
  optional string high_school_country_name = 7;
}

// --- Generic messages ---

message CodelistKey {
  string domain = 1 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 100
  ];

  string low_value = 2 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 240
  ];
}

message CodelistMeaning {
  string domain = 1;
  string low_value = 2;
  string meaning = 3;
}
